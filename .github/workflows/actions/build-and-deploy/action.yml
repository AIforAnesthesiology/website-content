name: "Build and Deploy"
description: "This will buid"
inputs:
  website-dir: # id of input
    description: "Website to build"
    required: true
    default: ""
  website-api: # id of input
    description: "Website Api"
    required: true
    default: ""
  netlify_key: # id of input
    description: "Netlify Key"
    required: true
    default: ""
  development: # id of input
    description: "development"
    required: false
    default: 0
  github_token:
    description: "github token"
    required: true
    default: ""

runs:
  using: "composite"
  steps:
    - name: Parse Publications
      shell: bash
      run: |
        curl -H "Authorization: token ${{ inputs.github_token }}" \
            -o content/diag.bib \
            -s \
            -L https://raw.githubusercontent.com/DIAGNijmegen/diag-literature/master/diag.bib

        curl -H "Authorization: token ${{ inputs.github_token }}" \
            -o content/fullstrings.bib \
            -s \
            -L https://raw.githubusercontent.com/DIAGNijmegen/diag-literature/master/fullstrings.bib

        python ./bibliography/bibparser.py

    - name: Copy Content
      run: bash copy_content.sh
      shell: bash
      env:
        WEBSITE: ${{ inputs.website-dir }}
    - name: Deploy Settings
      run: bash deploy.sh
      shell: bash
      env:
        WEBSITE: ${{ inputs.website-dir }}
        DEVELOPMENT: ${{ inputs.development }}
    - name: Netlify deploy
      run: |
        yarn global add netlify-cli
        "$(yarn global bin)/netlify" deploy --dir=${{ inputs.website-dir }}/output --prod
      shell: bash
      env:
        NETLIFY_AUTH_TOKEN: ${{ inputs.netlify_key }}
        NETLIFY_SITE_ID: ${{ inputs.website-api }}
